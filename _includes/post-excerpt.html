{% assign post = site.posts 
  | where_exp: "post", "post.slug == include.lookup"
  | first
  | default: include
%}

<div class="post-excerpt">
  {% assign url = post.url %}
  {% assign title = post.title %}
  <a href="{{ url | relative_url }}">{{ title }}</a>

  {%
    include post-info.html
    author=post.author
    published=post.date
    updated=post.last_modified_at
    tags=post.tags
  %}

  {% assign foundImage = 0 %}
  {% assign images = post.content | split:"<img " %}
  {% for image in images %}
    {% if image contains ‘src’ %}
        {% if foundImage == 0 %}
          {% assign html = image | split:"/>" | first %}
          {% assign tags = html | split:" " %}
            {% for tag in tags %}
              {% if tag contains 'src' %}
                <img {{ tag }} />
              {% endif %}
            {% endfor %}
          {% assign foundImage = 1 %}
        {% endif %}
    {% endif %}
  {% endfor %}

  {% assign excerpt = post.content
    | default: ""
    | regex_scan: "<!-- excerpt start -->(.*)<!-- excerpt end -->", true
    | default: post.excerpt
    | default: ""
    | strip_html
  %}
  {% assign search = post.content
    | strip_html 
    | strip_newlines
    | regex_strip
  %}
  <p data-search="{{ search }}">
    {{ excerpt }}
  </p>
</div>
